<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="it" data-bs-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Il mio Profilo</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
        }

        /* Header effetto vetro */
        .glass-header {
            background: rgba(13, 110, 253, 0.95);
            backdrop-filter: blur(10px);
        }

        /* Card personalizzata */
        .card-custom {
            border: none;
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.08);
            overflow: hidden;
            background: white;
        }

        /* Avatar */
        .avatar-circle {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #e0c3fc 0%, #8ec5fc 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
            color: white;
            font-size: 3rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        /* Bottoni Azione */
        .btn-action {
            padding: 12px 20px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.2s;
        }
        .btn-action:hover {
            transform: translateY(-2px);
        }

        /* Danger Zone */
        .danger-zone {
            background-color: #fff5f5;
            border-radius: 15px;
            padding: 20px;
            border: 1px dashed #dc3545;
        }
    </style>
</head>
<body>

<nav class="navbar navbar-dark glass-header mb-5 shadow-sm sticky-top">
    <div class="container">
        <span class="navbar-brand mb-0 h1 fw-bold">
            <i class="bi bi-person-badge-fill me-2"></i>Gestione Profilo
        </span>
        <a th:href="@{/user}" class="btn btn-sm btn-light rounded-pill px-3 fw-bold text-primary">
            <i class="bi bi-arrow-left me-1"></i> Dashboard
        </a>
    </div>
</nav>

<div class="container pb-5">
    <div class="row justify-content-center">
        <div class="col-lg-6 col-md-8">

            <div class="card card-custom mb-4">

                <div class="card-body text-center pt-5 pb-4 px-4">
                    <div class="avatar-circle mb-3">
                        <i class="bi bi-person-fill"></i>
                    </div>
                    <h3 class="fw-bold text-dark mb-1" th:text="${fullName}">Nome Utente</h3>
                    <p class="text-muted small text-uppercase fw-bold ls-1">Gestione Account</p>

                    <div class="bg-light rounded-4 p-3 mt-4 text-start">
                        <div class="d-flex justify-content-between align-items-center border-bottom pb-2 mb-2">
                            <span class="text-muted small fw-bold"><i class="bi bi-person me-1"></i> USERNAME</span>
                            <span class="fw-semibold text-dark" th:text="${username}">user</span>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-muted small fw-bold"><i class="bi bi-envelope-at me-1"></i> EMAIL</span>
                            <span class="fw-semibold text-dark" th:text="${email}">email@test.com</span>
                        </div>
                    </div>

                    <div class="row g-2 mt-4">
                        <div class="col-6">
                            <a th:href="@{/user/profile/password}" class="btn btn-outline-primary w-100 btn-action">
                                <i class="bi bi-key-fill d-block fs-4 mb-1"></i>
                                Password
                            </a>
                        </div>
                        <div class="col-6">
                            <a th:href="@{/user/profile/email}" class="btn btn-outline-primary w-100 btn-action">
                                <i class="bi bi-envelope-check-fill d-block fs-4 mb-1"></i>
                                Email
                            </a>
                        </div>
                    </div>
                </div>

                <div class="card-footer bg-white border-0 p-4 pt-0">
                    <div class="danger-zone mt-2">
                        <div class="d-flex align-items-center mb-2">
                            <i class="bi bi-exclamation-triangle-fill text-danger me-2 fs-5"></i>
                            <h6 class="fw-bold text-danger mb-0">Zona Pericolosa</h6>
                        </div>
                        <p class="text-muted small mb-3">
                            L'eliminazione dell'account è definitiva e cancellerà tutte le tue prenotazioni attive.
                        </p>

                        <form th:action="@{/user/profile/delete}" method="post" id="deleteForm">
                            <button type="button" class="btn btn-danger btn-sm w-100 fw-bold rounded-3" onclick="confirmDelete()">
                                <i class="bi bi-trash3-fill me-1"></i> Elimina il mio account
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="text-center text-muted small mt-3">
                &copy; 2025 MyBooking System &bull; <i class="bi bi-shield-lock"></i> Secure Connection
            </div>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script th:inline="javascript">
    /* GESTIONE MESSAGGI (TOAST)
       Legge i parametri 'message' o 'error' dall'URL inviati dal Controller
    */
    const urlParams = new URLSearchParams(window.location.search);
    const errorMsg = urlParams.get('error');
    const successMsg = urlParams.get('message');

    const Toast = Swal.mixin({
        toast: true,
        position: 'top',
        showConfirmButton: false,
        timer: 3000,
        timerProgressBar: true,
        didOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
    });

    if (errorMsg) {
        Toast.fire({ icon: 'error', title: errorMsg });
        // Pulisce l'URL
        window.history.replaceState({}, document.title, window.location.pathname);
    }
    if (successMsg) {
        Toast.fire({ icon: 'success', title: successMsg });
        // Pulisce l'URL
        window.history.replaceState({}, document.title, window.location.pathname);
    }

    /* CONFERMA ELIMINAZIONE ACCOUNT
       Usa SweetAlert invece del confirm() nativo brutto
    */
    function confirmDelete() {
        Swal.fire({
            title: 'Sei assolutamente sicuro?',
            text: "Questa azione non può essere annullata!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#6c757d',
            confirmButtonText: 'Sì, elimina tutto',
            cancelButtonText: 'Annulla',
            background: '#fff',
            customClass: {
                popup: 'rounded-4'
            }
        }).then((result) => {
            if (result.isConfirmed) {
                document.getElementById('deleteForm').submit();
            }
        });
    }
</script>

</body>
</html>